ONEDRIVE SAFE DEPLOY NOTE
=========================
Date: 2025-12-15

Objective:
Prevent catastrophic EPERM/Sync issues when deploying from OneDrive-synced folders on Windows.

Solution:
1. `scripts/deploy_runner.js`:
   - Detects if CWD is inside OneDrive.
   - If detected: Switches to Safe Mode (Workdir Strategy).
   - Default Workdir: `C:\Dev\InvoiceStudioDeployWorkdir`.
   - Action: Robocopies source (excluding `node_modules`, `.git`, `dist`) to Workdir.
   - Runs `npm ci`, migrations, and runtime FROM the Workdir.
   - Source folder remains untouched (safe).

2. Dry Run Fix:
   - In `deploy:dry` inside OneDrive, full server checks (Gate) are unstable due to file locking.
   - Modified logic to run `npm run build:client` only during Dry Run Verification in Source to prove build validity without risking server crash.
   - Workdir creation is simulated (log only).

3. Dependency Fix:
   - Discovered `lodash` missing from `client/package.json`. Added and installed.

Verification:
- `npm run deploy:dry` output in `debug/20_DEPLOY_DRY_RUN_OUTPUT.txt` confirms:
  - "SAFE MODE: Switching deployment..."
  - "Verifying Client Build only..." (Pass)
  - "Would create dir..." (Simulated Workdir)

Status:
PATCHED & VERIFIED.
